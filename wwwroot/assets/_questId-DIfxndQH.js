import{r as l,k as ee,b as te,a as se,j as e,t as d,Z as ae}from"./index-BM71IHYH.js";import{u as re,i as ie,E as le}from"./index-XGZyWgJn.js";import{S as ne,O as j}from"./Select-C4e6SRbX.js";import{R as oe,F as b,a as N,b as v,c as E,d as w,e as D,w as ce,D as de,f as xe,g as me,h as ue,i as pe,j as fe,k as ge}from"./field-eIo_uTst.js";import{t as he}from"./IconoirContext-DnFuTd40.js";import{x as ye}from"./Xmark-DvtNZVn5.js";import{B as x}from"./Button-DjVsqX09.js";import{F as k}from"./FormInputField-Xka4Ls7u.js";import{a as q,A as G,g as P}from"./utils-Dhn_WXxr.js";import{d as je,u as be,a as Ne}from"./quest.api-JQDOGfAe.js";import{u as ve}from"./useQuery-Bo-X5PFM.js";import{L as Ee}from"./Loader-xl498cTG.js";var we=Object.defineProperty,H=Object.getOwnPropertySymbols,De=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable,z=(t,r,i)=>r in t?we(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i,T=(t,r)=>{for(var i in r||(r={}))De.call(r,i)&&z(t,i,r[i]);if(H)for(var i of H(r))Te.call(r,i)&&z(t,i,r[i]);return t};const Ce=(t,r)=>{const i=l.useContext(he),o=T(T({},i),t);return l.createElement("svg",T({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:r},o),l.createElement("path",{d:"M20 9L18.005 20.3463C17.8369 21.3026 17.0062 22 16.0353 22H7.96474C6.99379 22 6.1631 21.3026 5.99496 20.3463L4 9",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),l.createElement("path",{d:"M21 6L15.375 6M3 6L8.625 6M8.625 6V4C8.625 2.89543 9.52043 2 10.625 2H13.375C14.4796 2 15.375 2.89543 15.375 4V6M8.625 6L15.375 6",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},Se=l.forwardRef(Ce);var Le=Se;function ze(){const{questId:t}=ee.useParams(),r=te(),i=se(),{data:o,isLoading:u}=ve({queryKey:["quest",t],queryFn:()=>Ne(t)});return u?e.jsx("div",{className:"flex justify-center items-center p-16",children:e.jsx(Ee,{})}):o?e.jsx(Qe,{quest:o,onUpdate:async()=>{await i.invalidateQueries({queryKey:["quests"]}),await i.invalidateQueries({queryKey:["quest",t]})},onNavigateBack:()=>r({to:"/dashboard/main-quest"})}):e.jsx("div",{className:"flex justify-center items-center p-16",children:e.jsx("p",{className:"text-gray-500 font-secondary",children:"Quest not found."})})}function Qe({quest:t,onUpdate:r,onNavigateBack:i}){const[o,u]=l.useState(!t.details),[m,C]=l.useState(t.tags),[S,L]=l.useState(""),[$,Q]=l.useState(!1),[R,X]=l.useState(t.difficultyRating),[K,V]=l.useState(q(t.difficultyRating)),[A,W]=l.useState(t.category),[I,Y]=l.useState(t.title),[p,F]=l.useState(!1),[f,O]=l.useState(!1),M=l.useRef(null);function B(s){const a=new Date(s),n=h=>h.toString().padStart(2,"0");return`${a.getFullYear()}-${n(a.getMonth()+1)}-${n(a.getDate())}T${n(a.getHours())}:${n(a.getMinutes())}`}async function U(s=!1){const a=M.current?.value??null;if(a===null)return d("No deadline selected");const n=new Date(a),h=g?.isEmpty?null:g.getJSON();F(!0);try{const c={title:I,details:h,difficultyRating:R,category:A,deadline:n,tags:m,completed:s?!0:t.completed};await be(t.id,c),await r(),d(s?"Quest completed! +XP earned!":"Quest updated successfully",{position:"bottom-left"}),s&&i()}catch(c){if(c instanceof G){const y=P(c);d(y?.data.message,{position:"bottom-left"})}else c instanceof ae&&c.issues.forEach(y=>d(y.message,{position:"bottom-left"}))}finally{F(!1)}}const Z=s=>{s.preventDefault();const a=S.trim().toUpperCase(),n=!m.includes(a);a!=""&&n&&(C([...m,a]),L(""),Q(!1))},_=s=>{C(m.filter(a=>a!==s))},J=s=>{const a=s.target.value;X(a),V(q(a))},g=re({extensions:[ie],content:t.details,editorProps:{attributes:{spellcheck:"true"}},onCreate:({editor:s})=>u(s.isEmpty),onUpdate:({editor:s})=>u(s.isEmpty)});return e.jsxs("div",{className:"p-4 grid grid-cols-1 gap-6 lg:grid-cols-[minmax(0,1fr)_400px] font-primary",children:[e.jsx("div",{className:"flex flex-col gap-y-6",children:e.jsxs("div",{className:"grow flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("span",{className:"text-white font-bold font-primary text-xl",children:"QUEST SCROLL"}),t.completed&&e.jsx("span",{className:"text-xs font-secondary font-bold text-accent-amber border border-accent-amber px-2 py-1",children:"COMPLETED"})]}),e.jsxs("div",{className:"grow p-4 flex flex-col gap-y-6",children:[e.jsx(k,{label:"QUEST TITLE",type:"text",placeholder:"Slay the deadline dragon",name:"questTitle",value:I,onChange:s=>Y(s.target.value),labelClassName:"text-white"}),e.jsxs("div",{className:"flex flex-col gap-y-3",children:[e.jsx("legend",{className:"text-white text-xs",children:"QUEST CATEGORY"}),e.jsxs(oe,{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",value:A,onValueChange:s=>W(s),disabled:t.completed,children:[e.jsx(b,{htmlFor:"quest-category-main",children:e.jsxs(N,{orientation:"horizontal",children:[e.jsxs(v,{children:[e.jsx(E,{className:"text-sm font-primary",children:"Main Quest"}),e.jsx(w,{className:"text-xs font-secondary",children:"Story-critical arc"})]}),e.jsx(D,{value:"MainQuest",id:"quest-category-main"})]})}),e.jsx(b,{htmlFor:"quest-category-side",children:e.jsxs(N,{orientation:"horizontal",children:[e.jsxs(v,{children:[e.jsx(E,{className:"text-sm font-primary",children:"Side Quest"}),e.jsx(w,{className:"text-xs font-secondary",children:"Optional loot"})]}),e.jsx(D,{value:"SideQuest",id:"quest-category-side"})]})}),e.jsx(b,{htmlFor:"quest-category-tutorial",children:e.jsxs(N,{orientation:"horizontal",children:[e.jsxs(v,{children:[e.jsx(E,{className:"text-sm font-primary",children:"Tutorials"}),e.jsx(w,{className:"text-xs font-secondary",children:"Learn the ropes"})]}),e.jsx(D,{value:"Tutorial",id:"quest-category-tutorial"})]})})]})]}),e.jsxs("div",{className:"grow flex flex-col gap-y-2",children:[e.jsx("span",{className:"text-white text-xs tracking-[0.2em]",children:"QUEST DETAILS"}),e.jsxs("div",{className:"grow quest-editor-shell",children:[o&&e.jsx("span",{className:"quest-editor-placeholder",children:"Document objectives, steps, and rewards for the quest."}),e.jsx(le,{editor:g,className:"quest-editor","aria-label":"Quest details editor"})]})]})]})]})}),e.jsxs("div",{className:"lg:border-l lg:border-border-primary md:p-6 flex flex-col gap-y-8",children:[e.jsx("span",{className:"text-white font-bold font-primary text-xl",children:"QUEST DATA"}),e.jsxs("div",{className:"flex flex-col gap-y-6 bg-[#000000]/30 p-4",children:[e.jsxs("div",{className:"flex flex-col items-stretch gap-y-2 font-primary text-xs",children:[e.jsx("label",{htmlFor:"difficulty-rating",className:"text-primary-green/70",children:"DIFFICULTY RATING"}),e.jsxs(ne,{id:"difficulty-rating",value:R,onChange:J,disabled:t.completed,children:[e.jsx(j,{value:"Low",children:"LOW"}),e.jsx(j,{value:"Medium",children:"MEDIUM"}),e.jsx(j,{value:"High",children:"HIGH"})]})]}),e.jsx("hr",{className:"bg-primary-green/60 h-0.5"}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("span",{className:"text-primary-green/70 text-xs",children:"EST. REWARD"}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(ce,{className:"text-primary-green"}),e.jsxs("span",{className:"text-primary-green font-bold",children:[K," XP"]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsxs("div",{className:"flex justify-between text-primary-green",children:[e.jsx("span",{className:"text-white",children:"TAGS"}),e.jsxs(de,{open:$,onOpenChange:Q,children:[e.jsx(xe,{asChild:!0,children:e.jsx(x,{variant:"clean",className:"p-0",children:"+ ADD TAG"})}),e.jsxs(me,{children:[e.jsxs(ue,{children:[e.jsx(pe,{children:"ADD NEW TAG"}),e.jsx(fe,{children:"Enter a tag to categorize your quest."})]}),e.jsxs("form",{onSubmit:Z,className:"flex flex-col gap-y-4 py-4",children:[e.jsx("div",{className:"flex flex-col gap-y-2",children:e.jsx(k,{id:"tag-name",label:"TAG NAME",labelClassName:"text-white text-xs",value:S,onChange:s=>L(s.target.value),placeholder:"URGENT, DAILY, etc.",autoFocus:!0})}),e.jsx(ge,{children:e.jsx(x,{type:"submit",variant:"filled",children:"CONFIRM TAG"})})]})]})]})]}),e.jsx("ul",{className:"flex flex-wrap gap-2 list-none font-secondary text-primary-green",children:m.map(s=>e.jsxs("li",{className:"font-semibold py-1 px-2 border border-border-primary flex items-center gap-x-2 bg-bg-secondary/30",children:[e.jsx("span",{className:"text-xs",children:s}),e.jsx(x,{variant:"clean",className:"p-0 text-primary-green hover:text-white transition-colors",onClick:()=>_(s),children:e.jsx(ye,{className:"size-4"})})]},s))})]}),e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx("span",{className:"text-white",children:"DEADLINE"}),e.jsx("input",{type:"datetime-local",className:"bg-bg-primary text-primary-green border border-border-primary p-2 disabled:opacity-50 disabled:cursor-not-allowed",ref:M,defaultValue:B(t.deadline),disabled:t.completed})]}),e.jsxs("div",{className:"flex flex-col gap-y-3 mt-auto",children:[e.jsx(x,{type:"button",variant:"filled",disabled:p||f,onClick:()=>U(!1),children:"UPDATE QUEST"}),!t.completed&&e.jsx(x,{type:"button",variant:"outline",disabled:p,onClick:()=>U(!0),children:"âœ“ MARK AS COMPLETED"}),!t.completed&&e.jsxs(x,{type:"button",variant:"clean",disabled:f||p,className:"text-red-400 hover:text-red-300 flex items-center justify-center gap-x-2",onClick:async()=>{if(confirm("Are you sure you want to delete this quest? This cannot be undone.")){O(!0);try{await je(t.id),d("Quest deleted",{position:"bottom-left"}),i(),r()}catch(s){if(s instanceof G){const a=P(s);d(a?.data.message,{position:"bottom-left"})}}finally{O(!1)}}},children:[e.jsx(Le,{className:"size-4"}),f?"DELETING...":"DELETE QUEST"]})]})]})]})}export{ze as component};
